<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="lexeme_analyzer.js"></script>
    <script type="text/javascript" src="exception.js"></script>
    <script type="text/javascript" src="parsing.js"></script>
    <script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="graphDraw.js"></script>
    <link rel="stylesheet" type="text/css" href="graphStyle.css"/>
    <title>Expression division tree</title>

</head>
<body>

<h id = "Name">Выполнил: Ушаков Максим, 471 ПМИ; Курс: Компьютерная алгебра.</h>

<p id = "Description">Возможные символы: +,-,/,*; функции: sin(), cos(), tg(), ctg(); числа целые и вещественные через точку
    (например, 0.5,23.); в грамматике присутствуют унарные минусы и плюсы (при этом выражение вида 5*-3 запрещено);
    реализованы скобки и приоритет операций без скобок (например, умножение приоритетнее сложения);
    в случае неверно введённого выражения дерево не построится. </p>

<form>
    <input name="text" type="text" size="100" id="text" value="Введите выражение"/>
    <input id="submit" type="button" value="Подтвердить"/>
</form>

<text id="ErrorLabel"/>

<!--svg width = "1000" height = "600" viewBox="0 0 1000 600">
    <def>
        <g id="textLabel">
            <text id="textOfLabel"/>
        </g>

        <g id="number">
            <rect class = "node" width="35" height ="20"/>
        </g>

        <g id="sign">
            <circle class = "node" cx = "10" cy = "10" r = "10"/>
        </g>

        <g id="func">
            <ellipse class = "node" cx = "20" cy = "10" rx = "20" ry = "10"/>
        </g>

        <g id = "leftArrow">
            <path class = "arrow" d="M40 0 L0 60 Z"/>
            <path class = "arrow" d="M0 60 L2 55 Z"/>
            <path class = "arrow" d="M0 60 L5 59 Z"/>
        </g>

        <g id = "rightArrow">
            <path class = "arrow" d="M0 0 L40 60 Z"/>
            <path class = "arrow" d="M40 60 L38 55 Z"/>
            <path class = "arrow" d="M40 60 L35 59 Z"/>
        </g>

    </def>
</svg-->

<script type="text/javascript">


    var elem2 = document.getElementById('submit');

    elem2.onclick = function() {
        //обнуляем счётчики
        inputExpression = document.getElementById('text').value+'$';
        index = 0;
        currentChar = '';
        flagIsExpressionGood = true;

        tree = new Node(null, null);
        currentNode = tree;

        d3.select("svg").remove();
        /*d3.select("svg").selectAll("use").remove();
        d3.select("svg").selectAll("text").remove();
        d3.select("svg").selectAll("path").remove();*/
        //

        try {
            gc();
            getNextLexeme();
            parseE();
        } catch (ex) {

            d3.select("body").append("svg")
            .attr("width", 800)
            .attr("height", 50)
            .attr("viewBox", "0 0 800 50")

            d3.select("svg").append("text")
            .attr("y", 30)
            .attr("x", 20)
            .text(function(d){return ex.out();})

            flagIsExpressionGood = false;
        }

        if (flagIsExpressionGood)
            tree.DrawGraph();

    }

</script>
</body>
</html>